<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kalkulator Faktor Kepelbagaian | MS 1979</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { font-family: 'Inter', sans-serif; }
    /* Custom scrollbar for better look */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .animate-fade-in { animation: fadeIn 0.5s ease-out; }
    .animate-slide-up { animation: slideUp 0.5s ease-out; }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0"
  }
}
</script>
</head>
<body class="bg-slate-50 text-slate-800 flex flex-col min-h-screen">
  <div id="root" class="flex flex-col min-h-screen"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // --- 1. ICONS (Replicating Lucide-React) ---
    const Icons = {
      Calculator: ({ size = 24, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>
      ),
      BookOpen: ({ size = 24, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
      ),
      HelpCircle: ({ size = 24, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
      ),
      Plus: ({ size = 24, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="M12 5v14"/></svg>
      ),
      Trash2: ({ size = 24, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
      ),
      RotateCcw: ({ size = 24, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
      ),
      Zap: ({ size = 24, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
      ),
      CheckCircle2: ({ size = 24, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>
      ),
      XCircle: ({ size = 24, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
      ),
      AlertCircle: ({ size = 24, className = "" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
      )
    };

    // --- 2. TYPES & CONSTANTS ---
    const LoadType = {
      LIGHTING: 'lighting',
      FLUORESCENT: 'fluorescent',
      CEILING_FAN: 'ceiling_fan',
      AIRCOND: 'aircond',
      HEATING_POWER: 'heating_power',
      COOKING: 'cooking',
      WATER_HEATER: 'water_heater',
      WATER_HEATER_CONTROLLED: 'water_heater_controlled',
      FLOOR_HEATER: 'floor_heater',
      SPACE_HEATER: 'space_heater',
      FINAL_CIRCUIT_RING: 'final_circuit_ring',
      FINAL_CIRCUIT_RADIAL: 'final_circuit_radial',
      OTHER_SOCKETS: 'other_sockets'
    };

    const LOAD_LABELS = {
      [LoadType.LIGHTING]: 'Lampu (Filamen)',
      [LoadType.FLUORESCENT]: 'Lampu (Kalimantang)',
      [LoadType.CEILING_FAN]: 'Kipas Siling',
      [LoadType.AIRCOND]: 'Penghawa Dingin (A/C)',
      [LoadType.HEATING_POWER]: 'Pemanasan dan Kuasa',
      [LoadType.COOKING]: 'Perkakas Memasak',
      [LoadType.WATER_HEATER]: 'Pemanas Air (Segera)',
      [LoadType.WATER_HEATER_CONTROLLED]: 'Pemanas Air (Kawalan Suhu)',
      [LoadType.FLOOR_HEATER]: 'Pemanas Lantai',
      [LoadType.SPACE_HEATER]: 'Pemanas Ruang',
      [LoadType.FINAL_CIRCUIT_RING]: 'Soket Alir Keluar (Gelang)',
      [LoadType.FINAL_CIRCUIT_RADIAL]: 'Soket Alir Keluar (Jejari)',
      [LoadType.OTHER_SOCKETS]: 'Soket Alir Keluar (Lain-lain)'
    };

    const DEFAULT_VOLTAGE = 230;

    // --- 3. CALCULATION SERVICE ---
    const calculateDiversity = (loads, voltage = DEFAULT_VOLTAGE) => {
      const groups = {};
      
      // Filter valid loads
      const validLoads = loads.filter(l => 
        l.type !== '' && 
        l.qty !== '' && Number(l.qty) > 0 &&
        l.power !== '' && Number(l.power) >= 0
      );

      // Group loads by type
      validLoads.forEach(l => {
        if (!groups[l.type]) groups[l.type] = [];
        groups[l.type].push(l);
      });

      const rows = [];
      let totalMax = 0;
      let totalEst = 0;

      for (const [typeStr, group] of Object.entries(groups)) {
        const type = typeStr;
        if (!group) continue;

        let groupMax = 0;
        let groupEst = 0;

        // Helper to sum max current based on Watts
        const sumMaxWatts = (factor = 1, divisor = voltage) => 
          group.reduce((s, l) => s + (l.qty * l.power * factor) / divisor, 0);
        
        // Helper to sum max current based on Amps (Direct input)
        const sumMaxAmps = () => 
          group.reduce((s, l) => s + (l.qty * l.power), 0);

        // Expand multiple quantity entries into individual circuit ratings for sorting logic
        const expandCircuits = (isAmps = true) => {
          const circuits = [];
          group.forEach(l => {
            const rating = isAmps ? l.power : (l.power / voltage);
            for(let i = 0; i < l.qty; i++) circuits.push(rating);
          });
          return circuits.sort((a, b) => b - a); // Descending
        };

        switch (type) {
          case LoadType.LIGHTING:
            groupMax = sumMaxWatts(1, voltage);
            groupEst = groupMax * 0.66;
            break;

          case LoadType.FLUORESCENT:
            // 1.8 multiplier for fluorescent startup/ballast
            groupMax = sumMaxWatts(1.8, voltage);
            groupEst = groupMax * 0.66;
            break;

          case LoadType.CEILING_FAN:
            // 0.85 power factor approx
            groupMax = group.reduce((s, l) => s + (l.qty * l.power) / (voltage * 0.85), 0);
            groupEst = groupMax * 0.66;
            break;

          case LoadType.AIRCOND:
            groupMax = group.reduce((s, l) => s + (l.qty * l.power) / (voltage * 0.85), 0);
            groupEst = groupMax; // No diversity
            break;

          case LoadType.HEATING_POWER:
            groupMax = sumMaxWatts(1, voltage);
            // 100% up to 10A + 50% remainder
            groupEst = groupMax <= 10 ? groupMax : 10 + (groupMax - 10) * 0.5;
            break;

          case LoadType.COOKING:
            groupMax = sumMaxWatts(1, voltage);
            // 10A + 30% remainder + 5A auxiliary
            const baseCooking = 10;
            const aux = 5;
            const remainder = Math.max(0, groupMax - baseCooking);
            groupEst = baseCooking + (remainder * 0.3) + aux;
            break;

          case LoadType.WATER_HEATER: // Instant
            groupMax = sumMaxWatts(1, voltage);
            const heaters = expandCircuits(false); // input is watts
            if (heaters.length > 0) groupEst += heaters[0]; // 1st: 100%
            if (heaters.length > 1) groupEst += heaters[1]; // 2nd: 100%
            if (heaters.length > 2) {
              const rest = heaters.slice(2).reduce((a, b) => a + b, 0);
              groupEst += rest * 0.25; // Remainder: 25%
            }
            break;

          case LoadType.WATER_HEATER_CONTROLLED:
          case LoadType.FLOOR_HEATER:
          case LoadType.SPACE_HEATER:
            groupMax = sumMaxWatts(1, voltage);
            groupEst = groupMax; // No diversity
            break;

          /* ---------------------------------------------------------
             UPDATED LOGIC: Ring and Radial Circuits
             1. Max Current = Quantity x Power (Amps)
             2. Estimated = 100% largest circuit + 40% remainder
          --------------------------------------------------------- */
          case LoadType.FINAL_CIRCUIT_RING:
          case LoadType.FINAL_CIRCUIT_RADIAL: {
            // Max is simple sum of Amps
            groupMax = sumMaxAmps();
            
            // Diversity Calculation
            const circuits = expandCircuits(true); // Input is Amps
            
            if (circuits.length > 0) {
              // 100% of the largest
              groupEst += circuits[0];
              
              // 40% of the rest
              if (circuits.length > 1) {
                const rest = circuits.slice(1).reduce((a, b) => a + b, 0);
                groupEst += rest * 0.4;
              }
            }
            break;
          }

          case LoadType.OTHER_SOCKETS:
            // Complex legacy logic for standard sockets based on MS 1979 optimization
            let totalSockets = 0;
            group.forEach(l => totalSockets += l.qty);
            
            let circuits2Socket = 0;
            let circuits3Socket = 0;

            if (totalSockets <= 2) {
              circuits2Socket = 1;
            } else {
               circuits3Socket = Math.floor((totalSockets - 1) / 3);
               circuits2Socket = Math.ceil((totalSockets - circuits3Socket * 3) / 2);
               while (circuits2Socket * 2 + circuits3Socket * 3 < totalSockets) {
                 circuits3Socket++;
                 circuits2Socket = Math.ceil((totalSockets - circuits3Socket * 3) / 2);
               }
            }
            
            groupMax = (circuits2Socket * 20) + (circuits3Socket * 32);
            
            const circuitAmps = [];
            for(let i=0; i<circuits2Socket; i++) circuitAmps.push(20);
            for(let i=0; i<circuits3Socket; i++) circuitAmps.push(32);
            circuitAmps.sort((a, b) => b - a);
            
            if (circuitAmps.length > 0) {
              groupEst = circuitAmps[0];
              const rest = circuitAmps.slice(1).reduce((a, b) => a + b, 0);
              groupEst += rest * 0.4;
            }
            break;
          
          default:
            groupMax = 0;
            groupEst = 0;
        }

        totalMax += groupMax;
        totalEst += groupEst;

        rows.push({
          label: LOAD_LABELS[type],
          maxCurrent: groupMax,
          estCurrent: groupEst
        });
      }

      return { rows, totalMax, totalEst };
    };

    // --- 4. COMPONENTS ---

    // Header Component
    const Header = ({ activeTab, setActiveTab }) => {
      const navItems = [
        { id: 'notes', label: 'Nota', icon: Icons.BookOpen },
        { id: 'calc', label: 'Pengiraan', icon: Icons.Calculator },
        { id: 'quiz', label: 'Soalan', icon: Icons.HelpCircle },
      ];

      return (
        <header className="bg-gradient-to-r from-blue-700 to-blue-900 text-white shadow-lg sticky top-0 z-50">
          <div className="max-w-5xl mx-auto px-4 py-6 md:py-8 text-center">
            <h1 className="text-2xl md:text-3xl font-bold mb-2 tracking-tight">Kalkulator Faktor Kepelbagaian</h1>
            <p className="text-blue-100 text-xs md:text-sm font-light">
              Berdasarkan piawaian elektrik Malaysia (MS 1979)
            </p>
          </div>
          
          <div className="bg-blue-800/50 backdrop-blur-sm border-t border-blue-600/30">
            <nav className="max-w-5xl mx-auto px-4 flex justify-center space-x-2 py-3">
              {navItems.map((item) => (
                <button
                  key={item.id}
                  onClick={() => setActiveTab(item.id)}
                  className={`flex items-center gap-2 px-5 py-2 rounded-full transition-all text-sm font-medium ${
                    activeTab === item.id
                      ? 'bg-white text-blue-900 shadow-md transform scale-105' 
                      : 'text-blue-100 hover:bg-blue-700/80 hover:text-white'
                  }`}
                >
                  <item.icon size={16} />
                  <span>{item.label}</span>
                </button>
              ))}
            </nav>
          </div>
        </header>
      );
    };

    // Notes Component
    const Notes = () => {
      const tableData = [
        { type: "Lampu (Filamen)", max: "Bilangan Beban × Kuasa / 230V", est: "66% daripada jumlah arus maksimum" },
        { type: "Lampu (Kalimantang)", max: "Bilangan Beban × Kuasa × 1.8 / 230V", est: "66% daripada jumlah arus maksimum" },
        { type: "Kipas Siling", max: "Bilangan Beban × Kuasa / 230V x 0.85", est: "66% daripada jumlah arus maksimum" },
        { type: "Penghawa Dingin", max: "Bilangan Beban × Kuasa / 230V x 0.85", est: "100% (Tiada Faktor Kepelbagaian)" },
        { type: "Pemanasan dan Kuasa", max: "Bilangan Beban × Kuasa / 230V", est: "100% sehingga 10A + 50% selebihnya" },
        { type: "Pemasak", max: "Bilangan Beban × Kuasa / 230V", est: "10A + 30% beban penuh + 5A aux" },
        { type: "Pemanas Air (Segera)", max: "Bilangan Beban × Kuasa / 230V", est: "100% 2 beban terbesar + 25% selebihnya" },
        { type: "Pemanas Air (Laras Suhu)", max: "Bilangan Beban × Kuasa / 230V", est: "100% (Tiada Faktor Kepelbagaian)" },
        { type: "Soket Alir Keluar (Gelang/Jejari)", max: "Bilangan Beban × Kuasa (A)", est: "100% litar terbesar + 40% selebihnya" },
      ];

      return (
        <div className="space-y-6 animate-fade-in">
          <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div className="p-6 border-b border-slate-100 bg-slate-50">
              <h2 className="text-xl font-bold text-slate-800">Formula Faktor Kepelbagaian</h2>
              <p className="text-slate-500 text-sm mt-1">Rujukan pantas pengiraan mengikut jenis beban</p>
            </div>
            
            <div className="overflow-x-auto">
              <table className="w-full text-sm text-left">
                <thead className="bg-blue-50 text-blue-900 uppercase font-semibold text-xs tracking-wider">
                  <tr>
                    <th className="px-6 py-4 rounded-tl-lg">Jenis Beban</th>
                    <th className="px-6 py-4">Arus Maksimum</th>
                    <th className="px-6 py-4 rounded-tr-lg">Arus Anggaran (Diversity)</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-slate-100">
                  {tableData.map((row, index) => (
                    <tr key={index} className="hover:bg-slate-50 transition-colors">
                      <td className="px-6 py-4 font-medium text-slate-900">{row.type}</td>
                      <td className="px-6 py-4 text-slate-600 font-mono text-xs">{row.max}</td>
                      <td className="px-6 py-4 text-slate-600">{row.est}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      );
    };

    // Quiz Component
    const Quiz = () => {
      const [answers, setAnswers] = useState({});
      const [showResult, setShowResult] = useState({});

      const questions = [
        {
          id: 1,
          text: "Apakah faktor kepelbagaian untuk lampu filamen?",
          options: [
            { value: 'a', label: '100% arus maksimum' },
            { value: 'b', label: '66% daripada arus maksimum' },
            { value: 'c', label: '50% daripada arus maksimum' },
            { value: 'd', label: '75% daripada arus maksimum' }
          ],
          correctAnswer: 'b',
          explanation: "Mengikut MS 1979, faktor kepelbagaian yang dibenarkan untuk lampu filamen ialah 66% daripada jumlah arus beban penuh."
        },
        {
          id: 2,
          text: "Bagaimana pengiraan arus anggaran untuk litar jejari (Radial Circuit)?",
          options: [
            { value: 'a', label: '100% litar terbesar + 40% bakinya' },
            { value: 'b', label: '100% semua litar' },
            { value: 'c', label: '66% daripada jumlah arus' },
            { value: 'd', label: '100% litar pertama + 50% bakinya' }
          ],
          correctAnswer: 'a',
          explanation: "Untuk litar akhir soket alir keluar (Jejari dan Gelang), pengiraannya ialah 100% permintaan arus litar terbesar ditambah 40% permintaan arus bagi setiap litar lain."
        },
        {
          id: 3,
          text: "Untuk pemanas air dengan kawalan laras suhu, apakah faktor kepelbagaian yang dibenarkan?",
          options: [
            { value: 'a', label: '66% arus maksimum' },
            { value: 'b', label: '50% arus maksimum' },
            { value: 'c', label: '100% arus maksimum (tiada)' },
            { value: 'd', label: '75% arus maksimum' }
          ],
          correctAnswer: 'c',
          explanation: "Pemanas air yang dikawal laras suhu tidak dibenarkan sebarang faktor kepelbagaian. Ia mesti dikira pada 100% beban penuh."
        }
      ];

      const handleCheck = (qId) => {
        if (!answers[qId]) return;
        setShowResult(prev => ({ ...prev, [qId]: true }));
      };

      return (
        <div className="space-y-6">
          <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm text-center">
            <h2 className="text-xl font-bold text-slate-800 mb-2">Uji Kefahaman Anda</h2>
            <p className="text-slate-500 mb-6">Jawab soalan berikut berkaitan piawaian MS 1979</p>
            <div className="flex justify-center mb-4">
                <img 
                    src="https://raw.githubusercontent.com/ilyaadli-art/caldiv/main/gambarcth.jpeg" 
                    alt="Example Diagram" 
                    className="rounded-lg shadow-md max-h-64 object-cover"
                />
            </div>
          </div>

          {questions.map((q) => {
            const isAnswered = showResult[q.id];
            const isCorrect = answers[q.id] === q.correctAnswer;
            
            return (
              <div key={q.id} className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden transition-all duration-300">
                <div className="p-6">
                  <div className="flex gap-3 mb-4">
                      <div className="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold">
                        {q.id}
                      </div>
                      <h3 className="text-lg font-medium text-slate-900 mt-0.5">{q.text}</h3>
                  </div>
                  
                  <div className="space-y-3 pl-11">
                    {q.options.map((opt) => (
                      <label 
                        key={opt.value} 
                        className={`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${
                          answers[q.id] === opt.value 
                            ? 'border-blue-500 bg-blue-50 ring-1 ring-blue-500' 
                            : 'border-slate-200 hover:border-blue-300'
                        }`}
                      >
                        <input 
                          type="radio" 
                          name={`q-${q.id}`} 
                          value={opt.value}
                          checked={answers[q.id] === opt.value}
                          onChange={() => !isAnswered && setAnswers(prev => ({ ...prev, [q.id]: opt.value }))}
                          disabled={isAnswered}
                          className="text-blue-600 focus:ring-blue-500 w-4 h-4"
                        />
                        <span className="text-slate-700">{opt.label}</span>
                      </label>
                    ))}

                    {!isAnswered ? (
                      <button 
                        onClick={() => handleCheck(q.id)}
                        disabled={!answers[q.id]}
                        className="mt-4 px-6 py-2 bg-blue-600 text-white rounded-md font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                      >
                        Semak Jawapan
                      </button>
                    ) : (
                      <div className={`mt-4 p-4 rounded-lg border ${isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`}>
                        <div className="flex items-start gap-3">
                          {isCorrect ? <Icons.CheckCircle2 className="text-green-600 shrink-0" size={24} /> : <Icons.XCircle className="text-red-600 shrink-0" size={24} />}
                          <div>
                            <p className={`font-bold ${isCorrect ? 'text-green-800' : 'text-red-800'}`}>
                              {isCorrect ? 'Jawapan Tepat!' : 'Kurang Tepat.'}
                            </p>
                            <p className="text-slate-700 text-sm mt-1">{q.explanation}</p>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      );
    };

    // Calculator Component
    const Calculator = () => {
      const [loads, setLoads] = useState([
        { id: '1', type: '', qty: '', power: '' }
      ]);
      const [voltage] = useState(DEFAULT_VOLTAGE);
      const [result, setResult] = useState(null);
      const [error, setError] = useState(null);

      const addLoad = () => {
        const newId = Math.random().toString(36).substr(2, 9);
        setLoads([...loads, { id: newId, type: '', qty: '', power: '' }]);
        setResult(null); 
        setError(null);
      };

      const removeLoad = (id) => {
        if (loads.length > 1) {
          setLoads(loads.filter(l => l.id !== id));
          setResult(null);
        } else {
          setError("Sekurang-kurangnya satu beban perlu ada.");
          setTimeout(() => setError(null), 3000);
        }
      };

      const updateLoad = (id, field, value) => {
        setLoads(loads.map(l => l.id === id ? { ...l, [field]: value } : l));
        setResult(null); 
        setError(null);
      };

      const handleCalculate = () => {
        // Validation
        const hasEmptyFields = loads.some(l => l.type === '' || l.qty === '' || l.power === '');
        
        if (hasEmptyFields) {
          setError("Sila pastikan semua ruangan (Jenis Beban, Bilangan, Kuasa) telah diisi.");
          return;
        }

        const hasZeroValues = loads.some(l => Number(l.qty) <= 0 || Number(l.power) < 0);
        if (hasZeroValues) {
          setError("Bilangan beban mesti lebih daripada 0 dan kuasa/ampere tidak boleh negatif.");
          return;
        }

        const calculated = calculateDiversity(loads, voltage);
        setResult(calculated);
        setError(null);
        
        // Smooth scroll to results
        setTimeout(() => {
          const element = document.getElementById('results-section');
          if (element) {
            element.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }, 100);
      };

      const handleReset = () => {
        if(window.confirm("Adakah anda pasti mahu menetapkan semula semua data?")) {
            setLoads([{ id: '1', type: '', qty: '', power: '' }]);
            setResult(null);
            setError(null);
        }
      };

      const isSocketType = (type) => {
        return type === LoadType.FINAL_CIRCUIT_RING || 
               type === LoadType.FINAL_CIRCUIT_RADIAL || 
               type === LoadType.OTHER_SOCKETS;
      };

      return (
        <div className="space-y-8 animate-fade-in pb-12">
          <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div className="p-6 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
              <div>
                  <h2 className="text-xl font-bold text-slate-800">Senarai Beban</h2>
                  <p className="text-sm text-slate-500">Voltan Sistem: {voltage}V</p>
              </div>
              <button 
                onClick={handleReset}
                className="text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-full transition-all p-2"
                title="Reset Semula"
              >
                <Icons.RotateCcw size={18} />
              </button>
            </div>
            
            <div className="p-6 space-y-6">
              {loads.map((load, index) => (
                <div key={load.id} className="relative bg-slate-50 p-4 rounded-lg border border-slate-200 hover:border-blue-300 transition-colors group">
                  <div className="absolute -left-3 top-1/2 -translate-y-1/2 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold shadow-sm ring-4 ring-white">
                    {index + 1}
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-12 gap-4 items-end">
                    <div className="md:col-span-5">
                      <label className="block text-xs font-semibold text-slate-500 uppercase mb-1">Jenis Beban</label>
                      <div className="relative">
                        <select 
                            value={load.type}
                            onChange={(e) => updateLoad(load.id, 'type', e.target.value)}
                            className={`w-full p-2.5 bg-white border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm appearance-none cursor-pointer ${load.type === '' ? 'text-slate-400 border-slate-300' : 'text-slate-900 border-slate-300'}`}
                        >
                            <option value="" disabled>Pilih Jenis Beban</option>
                            {Object.entries(LOAD_LABELS).map(([key, label]) => (
                            <option key={key} value={key} className="text-slate-900">{label}</option>
                            ))}
                        </select>
                        <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-500">
                            <svg className="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                        </div>
                      </div>
                    </div>

                    <div className="md:col-span-2">
                      <label className="block text-xs font-semibold text-slate-500 uppercase mb-1">Bilangan (Unit/Litar)</label>
                      <input 
                        type="number" 
                        min="1"
                        placeholder="1"
                        value={load.qty}
                        onChange={(e) => updateLoad(load.id, 'qty', e.target.value === '' ? '' : parseInt(e.target.value))}
                        className="w-full p-2.5 bg-white border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-sm placeholder:text-slate-300"
                      />
                    </div>

                    <div className="md:col-span-3">
                      <label className="block text-xs font-semibold text-slate-500 uppercase mb-1 flex justify-between">
                        <span>{isSocketType(load.type) ? 'Rating (Ampere)' : 'Kuasa (Watt)'}</span>
                      </label>
                      <input 
                        type="number" 
                        min="0"
                        placeholder={isSocketType(load.type) ? "Contoh: 32" : "Contoh: 60"}
                        value={load.power}
                        onChange={(e) => updateLoad(load.id, 'power', e.target.value === '' ? '' : parseFloat(e.target.value))}
                        className="w-full p-2.5 bg-white border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-sm placeholder:text-slate-300"
                      />
                    </div>

                    <div className="md:col-span-2 flex justify-end">
                      <button 
                        onClick={() => removeLoad(load.id)}
                        className="text-red-500 hover:bg-red-50 p-2.5 rounded-md transition-colors w-full md:w-auto flex justify-center border border-transparent hover:border-red-100"
                        disabled={loads.length === 1}
                        title="Padam Beban"
                      >
                        <Icons.Trash2 size={18} />
                      </button>
                    </div>
                  </div>
                </div>
              ))}

              {error && (
                <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2 text-sm animate-pulse">
                  <Icons.AlertCircle size={18} />
                  <span>{error}</span>
                </div>
              )}

              <div className="flex flex-col md:flex-row gap-4 pt-4 border-t border-slate-100">
                <button 
                  onClick={addLoad}
                  className="flex-1 py-3 border-2 border-dashed border-slate-300 rounded-lg text-slate-500 hover:border-blue-500 hover:text-blue-600 hover:bg-blue-50 transition-all flex items-center justify-center gap-2 font-medium group"
                >
                  <Icons.Plus size={20} className="group-hover:scale-110 transition-transform" />
                  Tambah Beban
                </button>
                <button 
                  onClick={handleCalculate}
                  className="flex-1 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md hover:shadow-lg transition-all flex items-center justify-center gap-2 font-bold text-lg active:scale-95 transform duration-150"
                >
                  <Icons.Calculator size={20} />
                  Kira
                </button>
              </div>
            </div>
          </div>

          {result && (
            <div id="results-section" className="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden animate-slide-up">
              <div className="bg-slate-900 text-white p-6 flex items-center gap-3">
                <div className="p-2 bg-slate-800 rounded-lg">
                    <Icons.Zap className="text-yellow-400" size={24} />
                </div>
                <div>
                    <h2 className="text-xl font-bold">Keputusan Pengiraan</h2>
                    <p className="text-slate-400 text-sm">Anggaran keperluan arus maksimum (Maximum Demand)</p>
                </div>
              </div>

              <div className="overflow-x-auto">
                <table className="w-full text-sm text-left">
                  <thead className="bg-slate-50 text-slate-700 uppercase font-semibold border-b border-slate-200 text-xs tracking-wider">
                    <tr>
                      <th className="px-6 py-4">Jenis Beban</th>
                      <th className="px-6 py-4 text-right">Arus Maksimum (A)</th>
                      <th className="px-6 py-4 text-right bg-blue-50 text-blue-900 border-l border-blue-100">Arus Anggaran (A)</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-slate-100">
                    {result.rows.map((row, idx) => (
                      <tr key={idx} className="hover:bg-slate-50">
                        <td className="px-6 py-4 font-medium text-slate-800">{row.label}</td>
                        <td className="px-6 py-4 text-right font-mono text-slate-600">{row.maxCurrent.toFixed(2)}</td>
                        <td className="px-6 py-4 text-right font-mono font-bold text-blue-700 bg-blue-50/50 border-l border-blue-100">{row.estCurrent.toFixed(2)}</td>
                      </tr>
                    ))}
                  </tbody>
                  <tfoot className="bg-slate-50 font-bold border-t border-slate-200 text-base">
                    <tr>
                      <td className="px-6 py-4 text-slate-800">JUMLAH KESELURUHAN</td>
                      <td className="px-6 py-4 text-right text-slate-800">{result.totalMax.toFixed(2)} A</td>
                      <td className="px-6 py-4 text-right text-blue-700 bg-blue-100 border-l border-blue-200">{result.totalEst.toFixed(2)} A</td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          )}

          <div className="bg-blue-50 p-6 rounded-xl border border-blue-100 text-blue-900 text-sm">
            <h3 className="font-bold mb-2 flex items-center gap-2">
                <Icons.AlertCircle size={16} />
                Panduan Penggunaan:
            </h3>
            <ul className="list-disc list-inside space-y-1 text-blue-800/80 ml-2">
              <li>Pilih <strong>Jenis Beban</strong> yang sesuai daripada senarai.</li>
              <li>Masukkan <strong>Kuasa (Watt)</strong>. Untuk soket, masukkan nilai dalam <strong>Ampere (A)</strong>.</li>
              <li>Tekan butang <strong>Tambah Beban</strong> untuk menambah peralatan lain.</li>
              <li>Tekan butang <strong>Kira</strong> untuk mendapatkan keputusan pengiraan.</li>
              <li>Untuk <strong>Soket Gelang & Jejari</strong>: Masukkan jumlah litar sebagai 'Bilangan' dan rating litar (cth: 32A atau 20A) di ruangan 'Ampere'.</li>
            </ul>
          </div>
        </div>
      );
    };

    // Main App Component
    const App = () => {
      const [activeTab, setActiveTab] = useState('calc');

      return (
        <div className="flex flex-col min-h-screen">
          <Header activeTab={activeTab} setActiveTab={setActiveTab} />
          
          <main className="flex-grow container max-w-5xl mx-auto px-4 py-8">
            {activeTab === 'notes' && <Notes />}
            {activeTab === 'calc' && <Calculator />}
            {activeTab === 'quiz' && <Quiz />}
          </main>
          
          <footer className="bg-slate-900 text-slate-400 py-8 mt-auto">
            <div className="container mx-auto px-4 text-center">
                <p className="font-medium text-slate-300 mb-2">Kalkulator Faktor Kepelbagaian MS 1979</p>
                <p className="text-xs text-slate-500">
                    Dibangunkan untuk tujuan pembelajaran dan rujukan pantas. Sila rujuk buku piawaian rasmi untuk pengiraan kritikal.
                </p>
                <p className="text-xs text-slate-600 mt-4">© {new Date().getFullYear()} All rights reserved.</p>
            </div>
          </footer>
        </div>
      );
    };

    // Render Logic
    const rootElement = document.getElementById('root');
    const root = ReactDOM.createRoot(rootElement);
    root.render(<App />);
  </script>
</body>
</html>
